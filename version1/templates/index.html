<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latent Loop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-enter { opacity: 0; transform: translateY(10px); }
        .fade-enter-active { opacity: 1; transform: translateY(0); transition: opacity 300ms, transform 300ms; }
    </style>
</head>
<body class="bg-gray-900 text-white h-screen flex overflow-hidden font-sans">

    <div class="w-1/3 border-r border-gray-800 p-6 flex flex-col bg-gray-900">
        <h2 class="text-gray-500 uppercase text-xs tracking-widest mb-4">Live Stream</h2>
        <div id="transcript-container" class="space-y-4 overflow-y-auto flex-1 text-gray-400 text-lg font-light">
            </div>
        
        <div class="mt-4">
            <input type="text" id="sim-input" placeholder="Type to simulate voice..." 
                class="w-full bg-gray-800 p-3 rounded text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
    </div>

    <div class="w-2/3 p-10 bg-black overflow-y-auto relative">
        <h1 class="text-3xl font-bold mb-8 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
            Latent Loop
        </h1>
        
        <div id="notes-container" class="space-y-8 max-w-3xl mx-auto">
            </div>
    </div>

    <script>
        const transcriptDiv = document.getElementById('transcript-container');
        const notesDiv = document.getElementById('notes-container');
        const simInput = document.getElementById('sim-input');

        // --- SIMULATION HANDLER ---
        simInput.addEventListener('keypress', async (e) => {
            if (e.key === 'Enter') {
                const text = simInput.value;
                simInput.value = '';
                
                // Optimistic UI
                transcriptDiv.innerHTML += `<p class="animate-pulse text-white">"${text}"</p>`;
                
                await fetch('/simulate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({text: text})
                });
            }
        });

        // --- LIVE UPDATES (SSE) ---
        const evtSource = new EventSource("/stream");
        
        evtSource.onmessage = function(event) {
            const data = JSON.parse(event.data);
            
            // 1. Update Transcript (Only showing last few lines logic needed here)
            // Ideally, handle diffing, but for now just replacing is fine or simple append
            // kept simple for hackathon:
            transcriptDiv.innerHTML = data.transcript.map(t => `<p>"${t}"</p>`).join('');

            // 2. Update Notes
            renderNotes(data.notes);
        };

        function renderNotes(notes) {
            // Very brute-force rendering. 
            // In a real app, use React to avoid flickering.
            // Here, we just rebuild the DOM.
            const html = notes.map(note => `
                <div class="bg-gray-900 p-6 rounded-xl border border-gray-800 hover:border-blue-500/50 transition-all duration-500">
                    <h3 class="text-xl font-semibold text-blue-400 mb-4">${note.title}</h3>
                    <div class="prose prose-invert text-gray-300">
                        ${note.content}
                    </div>
                </div>
            `).join('');
            
            // Only update if changed to prevent selection loss (basic check)
            if (notesDiv.innerHTML !== html) {
                notesDiv.innerHTML = html;
            }
        }
    </script>
</body>
</html>